{"version":3,"file":"confirm.min.js","sources":["../src/confirm.js"],"sourcesContent":["/* eslint-disable promise/always-return */\n/* eslint-disable promise/catch-or-return */\ndefine([\n  'jquery',\n  'core/config',\n  'core/templates',\n  'core/modal_factory',\n  'core/modal_events',\n  'core/str',\n  'core/notification',\n], function (\n  $,\n  mdlcfg,\n  templates,\n  ModalFactory,\n  ModalEvents,\n  str,\n  notification\n) {\n  return {\n    init: function (courseid, hide, coursename, categoryid) {\n      // Define variables.\n      var showhideaction;\n      var data;\n\n      // Define data array depending on hide variable.\n      if (hide == 1) {\n        showhideaction = 'hidecourse';\n        data = { hide: hide, coursename: coursename };\n      } else {\n        showhideaction = 'showcourse';\n        data = { coursename: coursename };\n      }\n\n      // Bind click event to show delete course modal to delete course button.\n      $('.btn-deletecourse').click(function (e) {\n        // Prevent default link action.\n        e.preventDefault();\n        var templateData = { coursename: coursename };\n        render_delete_modal(templateData);\n      });\n\n      /**\n       * This function creates a delete course modal\n       *\n       * @param {object} templateData Data used when render the modal\n       *\n       * @returns void\n       */\n      function render_delete_modal(templateData) {\n        // Defined string want to get\n        var strings = [\n          {\n            key: 'delete_course_modal_title',\n            component: 'block_mmquicklink',\n          },\n          {\n            key: 'delete_course_success_msg',\n            component: 'block_mmquicklink',\n          },\n          {\n            key: 'delete_course_failed_msg',\n            component: 'block_mmquicklink',\n          },\n        ];\n\n        str.get_strings(strings).then(function (translatedString) {\n          ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: templates.render(\n              'block_mmquicklink/modal_deletecourse_title',\n              templateData\n            ),\n            body: templates.render(\n              'block_mmquicklink/modal_deletecourse_body',\n              templateData\n            ),\n          }).then(function (modal) {\n            var deleteButtonText = translatedString[0];\n            modal.setSaveButtonText(deleteButtonText);\n            var root = modal.getRoot();\n            root.on(ModalEvents.save, function () {\n              var deleteSuccessMessage = translatedString[1];\n              var deleteFailMessage = translatedString[2];\n\n              $.get(mdlcfg.wwwroot + '/blocks/mmquicklink/delete.php', {\n                id: courseid,\n              })\n                .then(function () {\n                  notification.addNotification({\n                    message: deleteSuccessMessage,\n                    type: 'success',\n                  });\n                  setTimeout(function () {\n                    location.href = mdlcfg.wwwroot;\n                  }, 1000);\n                })\n                .catch(function () {\n                  notification.addNotification({\n                    message: deleteFailMessage,\n                    type: 'error',\n                  });\n                });\n            });\n            modal.show();\n          });\n        });\n      }\n\n      // What happens when user clicks hide/show course button.\n      $('.btn-hidecourse, .btn-showcourse').click(function (e) {\n        // Prevent default link action.\n        e.preventDefault();\n        createshowhidemodal(showhideaction, data);\n      });\n\n      /**\n       * This function creates a show/hide modal.\n       *\n       * @param {string} showhideaction\n       * @param {string} data\n       */\n      function createshowhidemodal(showhideaction, data) {\n        window.console.log(showhideaction); //showcourse hidecourse\n        $.get(\n          mdlcfg.wwwroot + '/blocks/mmquicklink/checkcompletionsettings.php',\n          {\n            courseid: courseid,\n            action: showhideaction,\n            confirm: true,\n            sesskey: mdlcfg.sesskey,\n          }\n        ).done(function (result) {\n          data.completionok = result;\n          data.url = mdlcfg.wwwroot + `/course/completion.php/?id=${courseid}`;\n          ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: templates.render(\n              'block_mmquicklink/modal_hidecourse_title',\n              data\n            ),\n            body: templates.render(\n              'block_mmquicklink/modal_hidecourse_body',\n              data\n            ),\n          }).then(function (modal) {\n            var root = modal.getRoot();\n            root.on(ModalEvents.save, function () {\n              $.get(mdlcfg.wwwroot + '/course/ajax/management.php', {\n                courseid: courseid,\n                action: showhideaction,\n                confirm: 1,\n                sesskey: mdlcfg.sesskey,\n              }).done(function () {\n                $.get(\n                  mdlcfg.wwwroot + '/blocks/mmquicklink/changevisibility.php',\n                  {\n                    courseid: courseid,\n                    action: showhideaction,\n                    confirm: 1,\n                    sesskey: mdlcfg.sesskey,\n                  }\n                ).done(function () {\n                  // Nothing to do here.\n                  location.reload();\n                });\n              });\n            });\n            modal.show();\n          });\n        });\n      }\n\n      /**\n       * This function creates a archive modal.\n       */\n      function archive() {\n        ModalFactory.create({\n          type: ModalFactory.types.SAVE_CANCEL,\n          title: templates.render(\n            'block_mmquicklink/modal_archivecourse_title',\n            data\n          ),\n          body: templates.render(\n            'block_mmquicklink/modal_archivecourse_body',\n            data\n          ),\n        }).then(function (modal) {\n          var root = modal.getRoot();\n          root.on(ModalEvents.save, function () {\n            $.get(mdlcfg.wwwroot + '/blocks/mmquicklink/archive.php', {\n              courseid: courseid,\n              categoryid: categoryid,\n              confirm: 1,\n            }).done(function () {\n              // Nothing to do here.\n              location.reload();\n            });\n          });\n          modal.show();\n        });\n      }\n\n      // What happens when user clicks archive course button.\n      $('.btn-archivecourse').click(function (e) {\n        // Prevent default link action.\n        e.preventDefault();\n        archive();\n      });\n    },\n  };\n});\n"],"names":["define","$","mdlcfg","templates","ModalFactory","ModalEvents","str","notification","init","courseid","hide","coursename","categoryid","showhideaction","data","click","e","preventDefault","templateData","strings","key","component","get_strings","then","translatedString","create","type","types","SAVE_CANCEL","title","render","body","modal","deleteButtonText","setSaveButtonText","getRoot","on","save","deleteSuccessMessage","deleteFailMessage","get","wwwroot","id","addNotification","message","setTimeout","location","href","catch","show","render_delete_modal","window","console","log","action","confirm","sesskey","done","result","completionok","url","reload","createshowhidemodal"],"mappings":"AAEAA,mCAAO,CACL,SACA,cACA,iBACA,qBACA,oBACA,WACA,sBACC,SACDC,EACAC,OACAC,UACAC,aACAC,YACAC,IACAC,oBAEO,CACLC,KAAM,SAAUC,SAAUC,KAAMC,WAAYC,gBAEtCC,eACAC,KAGQ,GAARJ,MACFG,eAAiB,aACjBC,KAAO,CAAEJ,KAAMA,KAAMC,WAAYA,cAEjCE,eAAiB,aACjBC,KAAO,CAAEH,WAAYA,aAIvBV,EAAE,qBAAqBc,OAAM,SAAUC,GAErCA,EAAEC,0BAYyBC,kBAEvBC,QAAU,CACZ,CACEC,IAAK,4BACLC,UAAW,qBAEb,CACED,IAAK,4BACLC,UAAW,qBAEb,CACED,IAAK,2BACLC,UAAW,sBAIff,IAAIgB,YAAYH,SAASI,MAAK,SAAUC,kBACtCpB,aAAaqB,OAAO,CAClBC,KAAMtB,aAAauB,MAAMC,YACzBC,MAAO1B,UAAU2B,OACf,6CACAZ,cAEFa,KAAM5B,UAAU2B,OACd,4CACAZ,gBAEDK,MAAK,SAAUS,WACZC,iBAAmBT,iBAAiB,GACxCQ,MAAME,kBAAkBD,kBACbD,MAAMG,UACZC,GAAG/B,YAAYgC,MAAM,eACpBC,qBAAuBd,iBAAiB,GACxCe,kBAAoBf,iBAAiB,GAEzCvB,EAAEuC,IAAItC,OAAOuC,QAAU,iCAAkC,CACvDC,GAAIjC,WAEHc,MAAK,WACJhB,aAAaoC,gBAAgB,CAC3BC,QAASN,qBACTZ,KAAM,YAERmB,YAAW,WACTC,SAASC,KAAO7C,OAAOuC,UACtB,QAEJO,OAAM,WACLzC,aAAaoC,gBAAgB,CAC3BC,QAASL,kBACTb,KAAM,gBAIdM,MAAMiB,aAjEVC,CADmB,CAAEvC,WAAYA,gBAwEnCV,EAAE,oCAAoCc,OAAM,SAAUC,GAEpDA,EAAEC,0BAUyBJ,eAAgBC,MAC3CqC,OAAOC,QAAQC,IAAIxC,gBACnBZ,EAAEuC,IACAtC,OAAOuC,QAAU,kDACjB,CACEhC,SAAUA,SACV6C,OAAQzC,eACR0C,SAAS,EACTC,QAAStD,OAAOsD,UAElBC,MAAK,SAAUC,QACf5C,KAAK6C,aAAeD,OACpB5C,KAAK8C,IAAM1D,OAAOuC,6CAAwChC,UAC1DL,aAAaqB,OAAO,CAClBC,KAAMtB,aAAauB,MAAMC,YACzBC,MAAO1B,UAAU2B,OACf,2CACAhB,MAEFiB,KAAM5B,UAAU2B,OACd,0CACAhB,QAEDS,MAAK,SAAUS,OACLA,MAAMG,UACZC,GAAG/B,YAAYgC,MAAM,WACxBpC,EAAEuC,IAAItC,OAAOuC,QAAU,8BAA+B,CACpDhC,SAAUA,SACV6C,OAAQzC,eACR0C,QAAS,EACTC,QAAStD,OAAOsD,UACfC,MAAK,WACNxD,EAAEuC,IACAtC,OAAOuC,QAAU,2CACjB,CACEhC,SAAUA,SACV6C,OAAQzC,eACR0C,QAAS,EACTC,QAAStD,OAAOsD,UAElBC,MAAK,WAELX,SAASe,kBAIf7B,MAAMiB,aAvDVa,CAAoBjD,eAAgBC,SA2FtCb,EAAE,sBAAsBc,OAAM,SAAUC,GAEtCA,EAAEC,iBA7BFb,aAAaqB,OAAO,CAClBC,KAAMtB,aAAauB,MAAMC,YACzBC,MAAO1B,UAAU2B,OACf,8CACAhB,MAEFiB,KAAM5B,UAAU2B,OACd,6CACAhB,QAEDS,MAAK,SAAUS,OACLA,MAAMG,UACZC,GAAG/B,YAAYgC,MAAM,WACxBpC,EAAEuC,IAAItC,OAAOuC,QAAU,kCAAmC,CACxDhC,SAAUA,SACVG,WAAYA,WACZ2C,QAAS,IACRE,MAAK,WAENX,SAASe,eAGb7B,MAAMiB"}